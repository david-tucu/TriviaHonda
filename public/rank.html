<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOP RANKING - TRIVIA HONDA</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <style>
        /* Estilos generales */
        /*  VARIABLES DE COLOR (ROJO)  */
        :root {
            --rojo-honda: #a80417;
            /* Rojo principal (oscuro) */
            --rojo-claro: #dc3545;
            /* Rojo de destaque (similar a danger de Bootstrap) */
            --fondo-gris: #f8f9fa;
            /* Fondo blanco-grisáceo */
            --texto-claro: #ffffff;
            --texto-oscuro: #212529;
        }

        /* Estilos generales */
        body {
            padding-top: 20px;
            background-color: var(--fondo-gris-claro);

        }

        /* Contenedor principal centrado */
        .container {
            max-width: 800px;
        }

        /* Título */
        h1 {
            color: var(--rojo-honda);
        }

        /* Centrar contenido en las celdas de la tabla */
        td,
        th {
            text-align: center;
        }

        /* Estilos de la tabla */
        .table-striped>tbody>tr:nth-of-type(odd)>* {
            background-color: rgba(168, 4, 23, 0.05);
            /* Rojo muy claro en las franjas */
        }



        /* 1er Lugar (Oro/Destacado) */
        /*
         .table-ranking tr:nth-child(1) {
            font-weight: bold;
            font-size: 1.2em;
        }
        */

        /* 2do Lugar (Plata) */
        /*
        .table-ranking tr:nth-child(2) {
            font-weight: bold;
            font-size: 1.1em;
        }
        */
    </style>
</head>

<body>
    <div class="container">

        <h1 class="mb-4 text-center">TOP RANKING - TRIVIA HONDA</h1>

        <div style="display: none;" id="resultado" class="alert alert-info d-none" role="alert">Calculando ranking...
        </div>

        <div id="table-container"></div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <script>
        // Función para renderizar la tabla con los datos del ranking
        function renderTable(data) {
            if (data.length === 0) {
                document.getElementById("resultado").className = "alert alert-warning";
                document.getElementById("resultado").innerHTML = "No hay registros de jugadores con respuestas correctas.";
                document.getElementById("table-container").innerHTML = "";
                return;
            }

            document.getElementById("resultado").className = "alert alert-success";
            document.getElementById("resultado").innerHTML = `Mostrando los ${data.length} primeros lugares.`;

            let html = '<div class="table-responsive">';

            // Usamos una clase custom para los estilos de ranking
            html += '<table class="table table-striped table-ranking">';
            html += "<thead><tr>";

            // Definimos el orden y los nombres de las columnas explícitamente
            const columnMap = {
                posicion: 'POSICIÓN',
                nombre: 'PARTICIPANTE',
                dni: 'DNI',
                puntaje_final: 'PUNTOS'
            };
            const cols = Object.keys(columnMap);

            cols.forEach(c => html += `<th scope="col">${columnMap[c]}</th>`);
            html += "</tr></thead><tbody>";

            data.forEach(row => {
                row.nombre = row.nombre.toUpperCase();
                html += "<tr>";
                // Solo incluimos las columnas definidas
                html += `<td>${row.posicion}</td>`;
                html += `<td>${row.nombre}</td>`;
                html += `<td>${row.dni}</td>`;
                html += `<td>${row.puntaje_final}</td>`;
                html += "</tr>";
            });

            html += "</tbody></table></div>";
            document.getElementById("table-container").innerHTML = html;
        }

        // Función reutilizable para manejar la lógica de fetch
        function fetchData(endpoint, message) {
            document.getElementById("resultado").className = "alert alert-info";
            document.getElementById("resultado").innerHTML = message;

            fetch(endpoint)
                .then(r => r.json())
                .then(result => {
                    if (!result.ok) {
                        document.getElementById("resultado").className = "alert alert-danger";
                        document.getElementById("resultado").innerHTML = "Error: " + result.error;
                        document.getElementById("table-container").innerHTML = "";
                        return;
                    }
                    renderTable(result.data);
                })
                .catch(err => {
                    document.getElementById("resultado").className = "alert alert-danger";
                    document.getElementById("resultado").textContent = "Error de conexión: " + err;
                    document.getElementById("table-container").innerHTML = "";
                });
        }

        // --- ACCIÓN PRINCIPAL AL CARGAR LA PÁGINA (ONLOAD) ---
        window.onload = () => {
            fetchData("/ver-rank", "Calculando ranking final...");
        };
    </script>

</body>

</html>