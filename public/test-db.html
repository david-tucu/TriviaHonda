<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Test DB</title>
<style>
body { font-family: Arial; padding: 20px; }
#resultado { margin-top: 20px; }
table { border-collapse: collapse; margin-top: 20px; }
th, td { border: 1px solid #ccc; padding: 8px; }
button { margin-right: 10px; }
</style>
</head>
<body>

<h1>Test de Conexi√≥n a Base de Datos</h1>

<button id="btn">Probar conexi√≥n</button>
<button id="btn200">Listar √∫ltimas 200 participaciones</button>

<div id="resultado">Esperando acci√≥n‚Ä¶</div>

<script>
function renderTable(data) {
    if (data.length === 0) {
        document.getElementById("resultado").innerHTML = "No hay registros.";
        return;
    }

    let html = "<table><tr>";

    const cols = Object.keys(data[0]);
    cols.forEach(c => html += `<th>${c}</th>`);
    html += "</tr>";

    data.forEach(row => {
        html += "<tr>";
        cols.forEach(c => html += `<td>${row[c]}</td>`);
        html += "</tr>";
    });

    html += "</table>";
    document.getElementById("resultado").innerHTML = html;
}


// üîπ Bot√≥n: Probar conexi√≥n
document.getElementById("btn").onclick = () => {
    document.getElementById("resultado").innerHTML = "Consultando‚Ä¶";

    fetch("/test-db")
        .then(r => r.json())
        .then(result => {
            if (!result.ok) {
                document.getElementById("resultado").innerHTML = "Error: " + result.error;
                return;
            }
            renderTable(result.data);
        })
        .catch(err => {
            document.getElementById("resultado").textContent = "Error de conexi√≥n: " + err;
        });
};


// üîπ Bot√≥n: √öltimas 200 participaciones
document.getElementById("btn200").onclick = () => {
    document.getElementById("resultado").innerHTML = "Consultando √∫ltimas 200‚Ä¶";

    fetch("/test-db-200")
        .then(r => r.json())
        .then(result => {
            if (!result.ok) {
                document.getElementById("resultado").innerHTML = "Error: " + result.error;
                return;
            }
            renderTable(result.data);
        })
        .catch(err => {
            document.getElementById("resultado").textContent =
                "Error de conexi√≥n: " + err;
        });
};
</script>

</body>
</html>
